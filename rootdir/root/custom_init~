#!/sbin/busybox sh
#made by Anomalchik and DerTeufel
BB=/sbin/busybox
cd /

$BB mkdir /tmp
$BB mount -t tmpfs tmpfs /tmp
$BB mount -t proc proc /proc

if $BB grep -q boot_reason=4 /proc/cmdline ; then
	$BB sed -e 's/fps\=5893/fps\=5893 androidboot\.selinux\=permissive/' /proc/cmdline > /tmp/cmdline
elif $BB grep -q boot_reason=1 /proc/cmdline ; then
	$BB sed -e 's/boot_reason\=1/boot_reason\=1 ro\.boot\.mode\=charger/' /proc/cmdline > /tmp/cmdline
	#$BB mv -f /init.charging.rc /init.rc
elif $BB grep -q boot_reason=3 /proc/cmdline ; then
	$BB sed -e 's/boot_reason\=3/boot_reason\=3 ro\.boot\.mode\=charger/' /proc/cmdline > /tmp/cmdline
	#$BB mv -f /init.charging.rc /init.rc
else
	$BB sed -e 's/boot_reason\=0/boot_reason\=0 androidboot\.selinux\=permissive/' /proc/cmdline > /tmp/cmdline
fi
$BB mount --bind -o ro /tmp/cmdline /proc/cmdline

$BB chmod 755 /init2
$BB mv /init2 /init
exec /init

